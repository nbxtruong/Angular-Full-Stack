<app-loading [condition]="isLoading"></app-loading>

<app-toast [message]="toast.message"></app-toast>

<div class="card" *ngIf="!isLoading">
  <!-- <h4 class="card-header">Current peoples ({{cats.length}})</h4> -->
  <div class="card-header">
    <div class="row">
      <div class="col-md-4 carHeaderTitel">
        <h4>Current peoples ({{cats.length}})</h4>
      </div>
      <div class="col-md-8" *ngIf="!isEditing">
        <button class="btn btn-sm btn-primary" (click)="addCat()">
          <i class="fa fa-plus"></i>
        </button>
      </div>
    </div>
    <input type="text" id="myInput" (keyup)="searchPeopleByName()" placeholder="Search for names..">
  </div>
  <div id="myTable" class="card-block">
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Username</th>
          <th>Name</th>
          <th>Room</th>
          <th>Role</th>
          <th>Photos</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody *ngIf="cats.length === 0">
        <tr>
          <td colspan="6">There are no peoples in the DB. Add a new people below.</td>
        </tr>
      </tbody>
      <tbody *ngIf="!isEditing">
        <tr *ngFor="let cat of cats">
          <td>{{cat.username}}</td>
          <td>{{cat.name}}</td>
          <td>{{cat.room}}</td>
          <td>{{cat.role}}</td>
          <td>
            <i class="fa fa-check-square-o" aria-hidden="true"></i>
          </td>
          <td>
            <button class="btn btn-sm btn-warning" (click)="enableEditing(cat)">
              <i class="fa fa-pencil"></i>
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteCat(cat)">
              <i class="fa fa-trash"></i>
            </button>
            <button class="btn btn-sm btn-info" data-toggle="modal" data-target="#cameraModal">
              <i class="fa fa-camera"></i>
            </button>
            <button class="btn btn-sm btn-success" data-toggle="modal" data-target="#cameraModal">
              <i class="fa fa-check"></i>
            </button>
          </td>
        </tr>
      </tbody>
      <tbody *ngIf="isEditing">
        <tr>
          <td colspan="6">
            <form class="form-inline" #form="ngForm" (ngSubmit)="editCat(cat)" style="display:inline">
              <div class="form-group">
                <input class="form-control" type="text" name="username" [(ngModel)]="cat.username" placeholder="Username" required>
              </div>
              <div class="form-group">
                <input class="form-control" type="text" name="name" [(ngModel)]="cat.name" placeholder="Name" required>
              </div>
              <div class="form-group">
                <input class="form-control" type="text" name="weight" [(ngModel)]="cat.room" placeholder="Room" required>
              </div>
              <div class="form-group">
                <select class="form-control" name="role" [(ngModel)]="cat.role">
                  <option value="" selected disabled>Role</option>
                  <option value="user">User</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
              <div class="form-group">
                <button class="btn btn-sm btn-primary" type="submit" [disabled]="!form.form.valid">
                  <i class="fa fa-floppy-o"></i>
                </button>
                <button class="btn btn-sm btn-warning" (click)="cancelEditing()">
                  <i class="fa fa-times"></i>
                </button>
              </div>
            </form>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- The Modal -->
<div class="modal fade" id="cameraModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Camera ({{base64.length}}/20)</h4>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <ack-webcam [(ref)]="webcam" [options]="options" (onSuccess)="onCamSuccess($event)" (onError)="onCamError($event)"></ack-webcam>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button *ngIf="base64.length != 20" type="button" class="btn btn-success" (click)="genBase64()">Take</button>
        <button *ngIf="base64.length == 20" type="button" class="btn btn-success" data-dismiss="modal">Summit</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>
